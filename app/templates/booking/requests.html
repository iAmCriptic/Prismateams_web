{% extends "base.html" %}

{% block title %}{{ _('booking.requests.page_title') }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">{{ _('booking.requests.breadcrumb_dashboard') }}</a></li>
        <li class="breadcrumb-item active">{{ _('booking.requests.breadcrumb_requests') }}</li>
    </ol>
</nav>

<h2>{{ _('booking.requests.heading') }}</h2>

<div class="mb-3">
    <div class="btn-group" role="group">
        <a href="{{ url_for('booking.requests', status='pending') }}" 
           class="btn btn-outline-{% if status_filter == 'pending' %}primary{% else %}secondary{% endif %}">
            {{ _('booking.requests.filters.pending') }}
        </a>
        <a href="{{ url_for('booking.requests', status='accepted') }}" 
           class="btn btn-outline-{% if status_filter == 'accepted' %}primary{% else %}secondary{% endif %}">
            {{ _('booking.requests.filters.accepted') }}
        </a>
        <a href="{{ url_for('booking.requests', status='rejected') }}" 
           class="btn btn-outline-{% if status_filter == 'rejected' %}primary{% else %}secondary{% endif %}">
            {{ _('booking.requests.filters.rejected') }}
        </a>
        <a href="{{ url_for('booking.requests', status='archived') }}" 
           class="btn btn-outline-{% if status_filter == 'archived' %}primary{% else %}secondary{% endif %}">
            {{ _('booking.requests.filters.archived') }}
        </a>
    </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="card">
    <div class="card-body">
        {% if requests %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>{{ _('booking.requests.table.event') }}</th>
                        <th>{{ _('booking.requests.table.email') }}</th>
                        <th>{{ _('booking.requests.table.date') }}</th>
                        <th>{{ _('booking.requests.table.form') }}</th>
                        <th>{{ _('booking.requests.table.status') }}</th>
                        <th>{{ _('booking.requests.table.created') }}</th>
                        <th>{{ _('booking.requests.table.actions') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in requests %}
                    <tr>
                        <td><strong>{{ request.event_name }}</strong></td>
                        <td>{{ request.email }}</td>
                        <td>
                            {% if request.event_date %}
                            {{ request.event_date.strftime('%d.%m.%Y') }}
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>{{ request.form.title }}</td>
                        <td>
                            {% if request.status == 'pending' %}
                            <span class="badge bg-warning">{{ _('booking.requests.status.pending') }}</span>
                            {% elif request.status == 'accepted' %}
                            <span class="badge bg-success">{{ _('booking.requests.status.accepted') }}</span>
                            {% elif request.status == 'rejected' %}
                            <span class="badge bg-danger">{{ _('booking.requests.status.rejected') }}</span>
                            {% elif request.status == 'archived' %}
                            <span class="badge bg-secondary">{{ _('booking.requests.status.archived') }}</span>
                            {% endif %}
                        </td>
                        <td>{{ request.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('booking.request_detail', request_id=request.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i> {{ _('booking.requests.table.details') }}
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted text-center py-5">{{ _('booking.requests.empty') }}</p>
        {% endif %}
    </div>
</div>
{% endblock %}

