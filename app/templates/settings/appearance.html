{% extends "base.html" %}

{% block title %}{{ _('settings.appearance.page_title') }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('settings.index') }}">{{ _('settings.appearance.breadcrumb_settings') }}</a></li>
        <li class="breadcrumb-item active">{{ _('settings.appearance.breadcrumb_appearance') }}</li>
    </ol>
</nav>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">{{ _('settings.appearance.heading') }}</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-4">
                        <label for="language" class="form-label">{{ _('settings.appearance.language_label') }}</label>
                        <select class="form-select" id="language" name="language">
                            {% for option in language_options %}
                            <option value="{{ option.code }}" {% if option.code == user.language %}selected{% endif %}>{{ option.label }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-text">{{ _('settings.appearance.language_help') }}</div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">{{ _('settings.appearance.accent_section_title') }}</label>
                        
                        <!-- Color Type Selection -->
                        <div class="mb-3">
                            <div class="btn-group" role="group" aria-label="{{ _('settings.appearance.color_type_label') }}">
                                <input type="radio" class="btn-check" name="color_type" id="color_solid" value="solid" {% if not user.accent_gradient %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="color_solid">
                                    <i class="bi bi-palette"></i> {{ _('settings.appearance.color_type_solid') }}
                                </label>
                                
                                <input type="radio" class="btn-check" name="color_type" id="color_gradient" value="gradient" {% if user.accent_gradient %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="color_gradient">
                                    <i class="bi bi-palette2"></i> {{ _('settings.appearance.color_type_gradient') }}
                                </label>
                            </div>
                        </div>
                        
                        <!-- Solid Color Input -->
                        <div id="solid-color-section" class="mb-3">
                            <label for="accent_color" class="form-label">{{ _('settings.appearance.accent_color_label') }}</label>
                            <div class="d-flex align-items-center gap-3">
                                <input type="color" class="form-control form-control-color" id="accent_color" name="accent_color" value="{{ user.accent_color }}" title="{{ _('settings.appearance.accent_color_label') }}">
                                <span id="color-preview" class="badge" style="background-color: {{ user.accent_color }}; padding: 1rem 2rem;">{{ _('settings.appearance.preview') }}</span>
                            </div>
                        </div>
                        
                        <!-- Gradient Input -->
                        <div id="gradient-section" class="mb-3" style="display: none;">
                            <label for="gradient_start" class="form-label">{{ _('settings.appearance.gradient_label') }}</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="gradient_start" class="form-label">{{ _('settings.appearance.gradient_start') }}</label>
                                    <input type="color" class="form-control form-control-color" id="gradient_start" name="gradient_start" value="#667eea">
                                </div>
                                <div class="col-md-6">
                                    <label for="gradient_end" class="form-label">{{ _('settings.appearance.gradient_end') }}</label>
                                    <input type="color" class="form-control form-control-color" id="gradient_end" name="gradient_end" value="#764ba2">
                                </div>
                            </div>
                            <div class="mt-2">
                                <label for="gradient_direction" class="form-label">{{ _('settings.appearance.gradient_direction') }}</label>
                                <select class="form-select" id="gradient_direction" name="gradient_direction">
                                    <option value="135deg">{{ _('settings.appearance.gradient_direction_diag_rt') }}</option>
                                    <option value="90deg">{{ _('settings.appearance.gradient_direction_horizontal') }}</option>
                                    <option value="180deg">{{ _('settings.appearance.gradient_direction_vertical') }}</option>
                                    <option value="45deg">{{ _('settings.appearance.gradient_direction_diag_lt') }}</option>
                                </select>
                            </div>
                            <div class="mt-2">
                                <span id="gradient-preview" class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 2rem;">{{ _('settings.appearance.preview') }}</span>
                            </div>
                        </div>
                        
                        <!-- Preset Gradients -->
                        <div class="mb-3">
                            <label class="form-label">{{ _('settings.appearance.presets_label') }}</label>
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#667eea" data-end="#764ba2">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.purple_blue') }}
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#f093fb" data-end="#f5576c">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.pink_red') }}
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#4facfe" data-end="#00f2fe">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.blue_cyan') }}
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#43e97b" data-end="#38f9d7">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.green_teal') }}
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#fa709a" data-end="#fee140">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.pink_yellow') }}
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-outline-secondary w-100 preset-gradient" data-start="#a8edea" data-end="#fed6e3">
                                        <div class="preset-preview" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); height: 20px; border-radius: 4px; margin-bottom: 4px;"></div>
                                        {{ _('settings.appearance.presets.pastel') }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hidden field for gradient -->
                        <input type="hidden" id="accent_gradient" name="accent_gradient" value="{{ user.accent_gradient or '' }}">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">{{ _('settings.appearance.design_section_label') }}</label>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="dark_mode" name="dark_mode" {% if user.dark_mode %}checked{% endif %}>
                            <label class="form-check-label" for="dark_mode">
                                <i class="bi bi-moon-stars"></i> {{ _('settings.appearance.dark_mode') }}
                            </label>
                        </div>
                        <div class="form-check form-switch ms-4">
                            <input class="form-check-input" type="checkbox" id="oled_mode" name="oled_mode" {% if user.oled_mode %}checked{% endif %} {% if not user.dark_mode %}disabled{% endif %}>
                            <label class="form-check-label" for="oled_mode">
                                <i class="bi bi-display"></i> {{ _('settings.appearance.oled_mode') }}
                            </label>
                            <small class="form-text text-muted d-block ms-4 mt-1">
                                {{ _('settings.appearance.oled_help') }}
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="preferred_layout" class="form-label">Layout-Präferenz</label>
                        <select class="form-select" id="preferred_layout" name="preferred_layout">
                            <option value="auto" {% if (user.preferred_layout or 'auto') == 'auto' %}selected{% endif %}>Automatisch (empfohlen)</option>
                            <option value="mobile" {% if user.preferred_layout == 'mobile' %}selected{% endif %}>Mobile-Layout</option>
                            <option value="desktop" {% if user.preferred_layout == 'desktop' %}selected{% endif %}>Desktop-Layout</option>
                        </select>
                        <div class="form-text">
                            Wählen Sie Ihr bevorzugtes Layout. "Automatisch" passt das Layout an die Bildschirmgröße an. 
                            "Desktop-Layout" ist besonders für Tablets nützlich, wenn Sie die Sidebar-Navigation bevorzugen.
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-accent">{{ _('settings.appearance.save_button') }}</button>
                        <a href="{{ url_for('settings.index') }}" class="btn btn-outline-secondary">{{ _('common.cancel') }}</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Color type switching
document.getElementById('color_solid').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('solid-color-section').style.display = 'block';
        document.getElementById('gradient-section').style.display = 'none';
        document.getElementById('accent_gradient').value = '';
    }
});

document.getElementById('color_gradient').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('solid-color-section').style.display = 'none';
        document.getElementById('gradient-section').style.display = 'block';
        updateGradientPreview();
    }
});

// Solid color preview
document.getElementById('accent_color').addEventListener('input', function(e) {
    document.getElementById('color-preview').style.backgroundColor = e.target.value;
});

// Gradient preview
function updateGradientPreview() {
    const start = document.getElementById('gradient_start').value;
    const end = document.getElementById('gradient_end').value;
    const direction = document.getElementById('gradient_direction').value;
    const gradient = `linear-gradient(${direction}, ${start} 0%, ${end} 100%)`;
    
    document.getElementById('gradient-preview').style.background = gradient;
    document.getElementById('accent_gradient').value = gradient;
}

document.getElementById('gradient_start').addEventListener('input', updateGradientPreview);
document.getElementById('gradient_end').addEventListener('input', updateGradientPreview);
document.getElementById('gradient_direction').addEventListener('change', updateGradientPreview);

// Preset gradients
document.querySelectorAll('.preset-gradient').forEach(button => {
    button.addEventListener('click', function() {
        const start = this.dataset.start;
        const end = this.dataset.end;
        
        document.getElementById('gradient_start').value = start;
        document.getElementById('gradient_end').value = end;
        updateGradientPreview();
        
        // Switch to gradient mode
        document.getElementById('color_gradient').checked = true;
        document.getElementById('solid-color-section').style.display = 'none';
        document.getElementById('gradient-section').style.display = 'block';
    });
});

// Initialize based on current user settings
{% if user.accent_gradient %}
document.getElementById('color_gradient').checked = true;
document.getElementById('solid-color-section').style.display = 'none';
document.getElementById('gradient-section').style.display = 'block';
{% endif %}

// OLED Mode Toggle - nur aktivieren wenn Dark Mode aktiv ist
document.getElementById('dark_mode').addEventListener('change', function() {
    const oledModeCheckbox = document.getElementById('oled_mode');
    if (!this.checked) {
        oledModeCheckbox.checked = false;
        oledModeCheckbox.disabled = true;
    } else {
        oledModeCheckbox.disabled = false;
    }
});
</script>
{% endblock %}



