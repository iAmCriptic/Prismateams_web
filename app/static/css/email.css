/* Email Styles */

/* Email Content Styles - PRESERVE ORIGINAL EMAIL FORMATTING */

/* MINIMAL INTERFERENCE - only prevent layout breaks */

.email-text-content {
    border: 1px solid var(--bs-border-color);
    border-radius: 0.5rem;
    padding: 1rem;
    background: var(--bs-body-bg);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    isolation: isolate;
}

.email-text-content pre,
.email-plain-text {
    white-space: pre-wrap;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    color: inherit;
    font-size: 1rem;
    line-height: 1.6;
}

[data-bs-theme="dark"] .email-text-content {
    background: #1a202c !important;
    border-color: #4a5568 !important;
    color: #e2e8f0 !important;
}

/* OLED Mode Email Text Content */
[data-oled-mode="true"] .email-text-content {
    background: #000000 !important;
    border-color: #1a1a1a !important;
}

[data-bs-theme="dark"] .email-text-content pre {
    color: #e2e8f0 !important;
}

.email-content-header {
    border-bottom: 1px solid var(--bs-border-color);
    padding-bottom: 0.5rem;
}

/* Ensure buttons have proper font */
.email-content-header .btn,
.email-view-toggle {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
    font-size: 0.875rem;
    font-weight: 400;
    cursor: pointer !important;
    pointer-events: auto !important;
}

/* Ensure toggle buttons work correctly */
.email-view-toggle {
    user-select: none;
    -webkit-user-select: none;
}

.email-view-toggle.active {
    background-color: var(--bs-primary) !important;
    border-color: var(--bs-primary) !important;
    color: white !important;
}

/* Ensure content visibility can be toggled */
.email-html-content,
.email-text-content {
    transition: display 0.2s ease;
}

/* Override any inline styles that might prevent toggling */
.email-content-wrapper .email-html-content[style*="display: none"],
.email-content-wrapper .email-text-content[style*="display: none"] {
    display: none !important;
}

.email-content-wrapper .email-html-content[style*="display: block"],
.email-content-wrapper .email-text-content[style*="display: block"] {
    display: block !important;
}

/* Attachment Styles */
.attachments-section .list-group-item {
    border-left: none;
    border-right: none;
    border-radius: 0;
}

.attachments-section .list-group-item:first-child {
    border-top-left-radius: 0.375rem;
    border-top-right-radius: 0.375rem;
}

.attachments-section .list-group-item:last-child {
    border-bottom-left-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
}

/* Dark mode email styles */
/* Dark mode email content - ONLY in email content box */
[data-bs-theme="dark"] .email-content-wrapper .email-html-content,
[data-bs-theme="dark"] .email-content-wrapper .email-text-content {
    background: var(--bs-dark);
    border-color: var(--bs-border-color);
}

[data-bs-theme="dark"] .email-content-wrapper .email-html-content table th,
[data-bs-theme="dark"] .email-content-wrapper .email-html-content table td {
    border-color: var(--bs-border-color);
}

/* Email Mobile Styles */
.email-item {
    padding: 0.75rem;
}

.d-md-none .email-item {
    padding: 1rem;
}

/* Text overflow fixes - AGGRESSIVE */
.email-sender {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
}

.email-subject {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
}

.email-preview {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
    display: block !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
}

/* Mobile specific text handling - FORCE NO SCROLLING */
@media (max-width: 767.98px) {
    .email-sender {
        max-width: 60% !important;
        font-size: 0.9rem !important;
    }
    
    .email-subject {
        max-width: 60% !important;
        font-size: 0.85rem !important;
    }
    
    .email-preview {
        max-width: 60% !important;
        font-size: 0.8rem !important;
    }
    
    /* Force all text to stay within bounds */
    * {
        max-width: 100% !important;
        overflow-x: hidden !important;
        word-wrap: break-word !important;
        word-break: break-word !important;
    }
}

/* Email Content Styling - Formatierungs-Isolation */

/* Formatierungs-Isolation: HTML-Inhalte dürfen nicht außerhalb des E-Mail-Viewers wirken */
.email-content-isolated {
    isolation: isolate;
    contain: layout style paint;
    background: #ffffff !important;
    border: 1px solid #e0e0e0 !important;
    border-radius: 8px;
    padding: 20px;
    margin: 0;
    max-width: 100%;
    overflow-x: auto;
    word-wrap: break-word;
    overflow-wrap: break-word;
    box-sizing: border-box;
    /* Verhindere CSS-Bleeding */
    position: relative;
    z-index: 1;
}

/* Dark Mode Formatierungs-Isolation */
[data-bs-theme="dark"] .email-content-isolated {
    background: #1a202c !important;
    border-color: #4a5568 !important;
}

/* OLED Mode Email Content Isolated */
[data-oled-mode="true"] .email-content-isolated {
    background: #000000 !important;
    border-color: #1a1a1a !important;
    color: #e2e8f0 !important;
}

/* Verhindere, dass HTML-Formatierung außerhalb des Containers wirkt */
.email-content-wrapper {
    position: relative;
    isolation: isolate;
    contain: layout style paint;
    background: transparent !important;
    /* Isoliere den Wrapper komplett */
    all: initial;
    display: block;
    background: var(--bs-body-bg) !important;
}

.email-content-wrapper * {
    max-width: 100% !important;
    box-sizing: border-box;
}

/* Verhindere, dass E-Mail-Styles auf den Container wirken */
.email-content-wrapper::before,
.email-content-wrapper::after {
    content: '';
    display: none;
}

/* Preserve HTML email structure - minimal interference */

/* Preserve original link styling - minimal interference */

/* Ensure images are responsive - minimal interference */

/* Minimal table styling - preserve original email formatting */

/* Dark mode email content - ONLY in email content box */
[data-bs-theme="dark"] .email-content-wrapper .email-html-content,
[data-bs-theme="dark"] .email-content-wrapper .email-text-content {
    background-color: #1a202c !important;
}

/* OLED Mode Email Content Wrapper */
[data-oled-mode="true"] .email-content-wrapper .email-html-content,
[data-oled-mode="true"] .email-content-wrapper .email-text-content {
    background-color: #000000 !important;
    border-color: #4a5568 !important;
    color: #e2e8f0 !important;
}

/* Dark mode HTML email styling - ONLY in email content box */
[data-bs-theme="dark"] .email-content-wrapper .email-html-content {
    background: #1a202c !important;
    color: #e2e8f0 !important;
    border-color: #4a5568 !important;
}

/* Zusätzliche Isolation: Verhindere, dass E-Mail-Styles den Body beeinflussen */
body {
    background: var(--bs-body-bg) !important;
    color: var(--bs-body-color) !important;
}

/* Verhindere, dass E-Mail-Inhalte den Hintergrund ändern */
.email-content-wrapper {
    background: var(--bs-body-bg) !important;
    /* Verhindere, dass E-Mail-Styles den Container beeinflussen */
    background-image: none !important;
    background-color: var(--bs-body-bg) !important;
}

.email-content-wrapper::before,
.email-content-wrapper::after {
    display: none !important;
    content: none !important;
}

/* Zusätzliche Sicherheit: Überschreibe alle Hintergrund-Styles */
.card .email-content-wrapper,
.card-body .email-content-wrapper {
    background: var(--bs-body-bg) !important;
    background-image: none !important;
}

/* Verhindere, dass inline styles aus E-Mails den Hintergrund beeinflussen */
.email-content-wrapper .email-html-content[style*="background"],
.email-content-wrapper .email-html-content[style*="background-color"] {
    /* Überschreibe inline styles für Hintergrund */
    background: #ffffff !important;
}

[data-bs-theme="dark"] .email-content-wrapper .email-html-content[style*="background"],
[data-bs-theme="dark"] .email-content-wrapper .email-html-content[style*="background-color"] {
    background: #1a202c !important;
}

/* OLED Mode Email HTML Content Background Override */
[data-oled-mode="true"] .email-content-wrapper .email-html-content[style*="background"],
[data-oled-mode="true"] .email-content-wrapper .email-html-content[style*="background-color"] {
    background: #000000 !important;
}

/* Dark mode email list styling */
[data-bs-theme="dark"] .email-sender,
[data-bs-theme="dark"] .email-subject,
[data-bs-theme="dark"] .email-preview {
    color: #e2e8f0 !important;
}

[data-bs-theme="dark"] .email-item a {
    color: #e2e8f0 !important;
}

[data-bs-theme="dark"] .email-item a:hover {
    color: #ffffff !important;
}

[data-bs-theme="dark"] .email-item .text-muted {
    color: #adb5bd !important;
}

/* Dark mode email content styling - ONLY in email content box */
[data-bs-theme="dark"] .email-content-wrapper .email-html-content a {
    color: #60a5fa !important;
}

[data-bs-theme="dark"] .email-content-wrapper .email-html-content a:hover {
    color: #93c5fd !important;
}

[data-bs-theme="dark"] .email-content-wrapper .email-html-content td,
[data-bs-theme="dark"] .email-content-wrapper .email-html-content th {
    border-color: #4a5568 !important;
    color: #e2e8f0 !important;
}

[data-bs-theme="dark"] .email-content-wrapper .email-html-content blockquote {
    border-left-color: #4a5568 !important;
    color: #a0aec0 !important;
}

/* Removed general .email-html-content rules to avoid affecting other areas */

/* Preserve original email formatting - minimal interference */

/* Ensure proper email HTML rendering - ONLY for the email content box */
.email-content-wrapper .email-html-content {
    display: block;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    color: #333333 !important;
    background: #ffffff !important;
    padding: 20px;
    border: 1px solid #e0e0e0 !important;
    border-radius: 8px;
    max-width: 100%;
    overflow-x: auto;
    word-wrap: break-word;
    overflow-wrap: break-word;
    box-sizing: border-box;
    isolation: isolate;
    contain: layout style paint;
    position: relative;
    z-index: 1;
    /* Verhindere CSS-Bleeding */
    all: unset;
    display: block;
    background: #ffffff !important;
    color: #333333 !important;
    border: 1px solid #e0e0e0 !important;
    border-radius: 8px;
    padding: 20px;
    margin: 0;
    max-width: 100%;
    overflow-x: auto;
    word-wrap: break-word;
    overflow-wrap: break-word;
    box-sizing: border-box;
    isolation: isolate;
    contain: layout style paint;
}

/* Dark Mode HTML Content */
[data-bs-theme="dark"] .email-content-wrapper .email-html-content {
    background: #1a202c !important;
    color: #e2e8f0 !important;
    border-color: #4a5568 !important;
}

/* Verhindere, dass E-Mail-Inhalte den Hintergrund beeinflussen */
.email-content-wrapper .email-html-content * {
    /* Isoliere alle Kindelemente */
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Verhindere, dass body/html-Tags aus E-Mails den Hintergrund beeinflussen */
.email-content-wrapper .email-html-content body,
.email-content-wrapper .email-html-content html {
    background: transparent !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* Verhindere, dass Hintergrundfarben aus E-Mails nach außen wirken */
.email-content-wrapper .email-html-content > * {
    background-clip: padding-box !important;
}

/* Isoliere E-Mail-Body-Wrapper */
.email-content-isolated-inner,
.email-body-wrapper {
    background: transparent !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* Überschreibe alle möglichen Hintergrund-Styles aus E-Mails */
.email-content-wrapper .email-html-content,
.email-content-wrapper .email-html-content *,
.email-content-wrapper .email-html-content .email-body-wrapper,
.email-content-wrapper .email-html-content .email-content-isolated-inner {
    /* Verhindere, dass E-Mail-Styles den Body beeinflussen */
    background-attachment: scroll !important;
    background-position: 0 0 !important;
}

/* Isoliere E-Mail-Inhalte komplett */
.email-content-wrapper {
    /* Erstelle einen neuen Stacking Context - nur auf Desktop */
    isolation: isolate;
}

/* Desktop: Zusätzliche Isolation */
@media (min-width: 768px) {
    .email-content-wrapper {
        transform: translateZ(0);
        will-change: contents;
    }
}

/* Mobile: Keine transform, da es zu Skalierungsproblemen führen kann */
@media (max-width: 767.98px) {
    .email-content-wrapper {
        transform: none;
        will-change: auto;
    }
}

/* Verhindere, dass E-Mail-Inhalte über den Container hinauswirken */
.email-content-wrapper .email-html-content {
    /* Erzwinge Isolation - aber nicht auf mobil */
    isolation: isolate;
}

/* Desktop: Strikte Isolation */
@media (min-width: 768px) {
    .email-content-wrapper .email-html-content {
        transform: translateZ(0);
        contain: layout style paint;
    }
}

/* Mobile: Keine contain: strict, da es zu Problemen führt */
@media (max-width: 767.98px) {
    .email-content-wrapper .email-html-content {
        contain: none;
        transform: none;
    }
}

/* Preserve email table formatting - ONLY in email content box */
.email-content-wrapper .email-html-content table {
    border-collapse: collapse;
    width: 100%;
    max-width: 100%;
}

.email-content-wrapper .email-html-content td,
.email-content-wrapper .email-html-content th {
    padding: 8px;
    border: 1px solid #ddd;
    vertical-align: top;
}

/* Preserve email image formatting - ONLY in email content box */
.email-content-wrapper .email-html-content img {
    max-width: 100% !important;
    height: auto !important;
    display: block;
    margin: 0 auto;
}

/* Preserve email link formatting - ONLY in email content box */
.email-content-wrapper .email-html-content a {
    color: inherit;
    text-decoration: inherit;
    cursor: pointer;
}

/* Preserve email text formatting - ONLY in email content box */
.email-content-wrapper .email-html-content p {
    margin: 0 0 1em 0;
    line-height: inherit;
}

.email-content-wrapper .email-html-content h1,
.email-content-wrapper .email-html-content h2,
.email-content-wrapper .email-html-content h3,
.email-content-wrapper .email-html-content h4,
.email-content-wrapper .email-html-content h5,
.email-content-wrapper .email-html-content h6 {
    margin: 0 0 0.5em 0;
    font-weight: bold;
    line-height: inherit;
}

/* Preserve email list formatting - ONLY in email content box */
.email-content-wrapper .email-html-content ul,
.email-content-wrapper .email-html-content ol {
    margin: 0 0 1em 0;
    padding-left: 2em;
}

.email-content-wrapper .email-html-content li {
    margin: 0 0 0.25em 0;
    line-height: inherit;
}

/* Ensure email content doesn't break layout - ONLY in email content box */
.email-content-wrapper .email-html-content * {
    max-width: 100% !important;
    box-sizing: border-box;
    /* Preserve original email styling */
}

/* Email Attachments Styling */
.attachments-section {
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 1rem;
    background-color: #f8f9fa;
}

[data-bs-theme="dark"] .attachments-section {
    border-color: #495057;
    background-color: #212529;
}

/* OLED Mode Attachments Section */
[data-oled-mode="true"] .attachments-section {
    background-color: #000000 !important;
    border-color: #1a1a1a !important;
}

/* OLED Mode - Email Items mit Rahmen statt grauem Hintergrund */
[data-oled-mode="true"] .email-item {
    background-color: #000000 !important;
    border: 1px solid #1a1a1a !important;
    border-radius: 0.375rem !important;
    margin-bottom: 0.5rem !important;
}

[data-oled-mode="true"] .email-item:hover {
    border-color: #2a2a2a !important;
    background-color: #000000 !important;
}

/* OLED Mode - Email Sidebar */
[data-oled-mode="true"] .email-sidebar {
    background-color: #000000 !important;
    border-right: 1px solid #1a1a1a !important;
}

/* OLED Mode - Email Folder Links */
[data-oled-mode="true"] .email-folder-link {
    background-color: transparent !important;
    border: 1px solid transparent !important;
}

[data-oled-mode="true"] .email-folder-link:hover {
    background-color: #000000 !important;
    border-color: #1a1a1a !important;
}

[data-oled-mode="true"] .email-folder-link.active {
    background-color: transparent !important;
    border: 1px solid var(--accent-color) !important;
}

/* OLED Mode - Email List Background */
[data-oled-mode="true"] .email-list {
    background-color: #000000 !important;
}

/* OLED Mode - Email Main Content */
[data-oled-mode="true"] .email-main-content {
    background-color: #000000 !important;
}

.attachments-section .list-group-item {
    border: none;
    border-bottom: 1px solid #dee2e6;
    padding: 0.75rem 0;
}

.attachments-section .list-group-item:last-child {
    border-bottom: none;
}

[data-bs-theme="dark"] .attachments-section .list-group-item {
    border-bottom-color: #495057;
    background-color: transparent;
}

/* OLED Mode - Attachments List Group Items */
[data-oled-mode="true"] .attachments-section .list-group-item {
    background-color: #000000 !important;
    border: 1px solid #1a1a1a !important;
    border-radius: 0.375rem !important;
    margin-bottom: 0.25rem !important;
    border-bottom: 1px solid #1a1a1a !important;
}

[data-oled-mode="true"] .attachments-section .list-group-item:hover {
    border-color: #2a2a2a !important;
    background-color: #000000 !important;
}

/* Email Layout with Sidebar (Desktop ab 1024px) */
.email-layout-desktop {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
}

.email-folder-sidebar {
    width: 240px;
    flex-shrink: 0;
    padding: 1rem;
    background: var(--bs-body-bg);
    border-right: 1px solid var(--bs-border-color);
    min-height: calc(100vh - 120px);
}

/* OLED Mode - Email Folder Sidebar */
[data-oled-mode="true"] .email-folder-sidebar {
    background-color: #000000 !important;
    border-right-color: #1a1a1a !important;
}

.email-main-content {
    flex: 1;
    min-width: 0;
}

.email-folder-list {
    gap: 0.25rem;
}

.email-folder-link {
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
    transition: all 0.2s ease;
}

.email-folder-link:hover {
    background-color: var(--bs-secondary-bg);
}

.email-folder-link.active {
    background-color: var(--accent-color, var(--bs-primary));
    color: white !important;
}

[data-bs-theme="dark"] .email-folder-link.active {
    background-color: var(--accent-color, var(--bs-primary));
    color: white !important;
}

/* Avatar Circles for Email Senders - ERZWINGE RUNDE FORM */
.email-avatar {
    flex-shrink: 0;
}

/* ERZWINGE RUNDE FORM - Sehr hohe Spezifität */
.email-avatar .avatar-circle,
.email-item .avatar-circle,
.list-group-item .avatar-circle,
.email-list .avatar-circle,
div.avatar-circle {
    width: 40px !important;
    height: 40px !important;
    min-width: 40px !important;
    min-height: 40px !important;
    max-width: 40px !important;
    max-height: 40px !important;
    border-radius: 50% !important;
    -webkit-border-radius: 50% !important;
    -moz-border-radius: 50% !important;
    border-top-left-radius: 50% !important;
    border-top-right-radius: 50% !important;
    border-bottom-left-radius: 50% !important;
    border-bottom-right-radius: 50% !important;
    background: var(--accent-style, linear-gradient(135deg, #667eea 0%, #764ba2 100%)) !important;
    color: white !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-weight: 600 !important;
    font-size: 0.875rem !important;
    text-transform: uppercase !important;
    flex-shrink: 0 !important;
    /* Erzwinge runde Form mit mehreren Methoden */
    aspect-ratio: 1 / 1 !important;
    overflow: hidden !important;
    /* CLIP-PATH ERZWINGT RUNDE FORM */
    clip-path: circle(50% at 50% 50%) !important;
    -webkit-clip-path: circle(50% at 50% 50%) !important;
    /* Shape-Outline als Backup */
    shape-outside: circle(50%) !important;
    /* Verhindere alle möglichen Überschreibungen */
    border-style: none !important;
    box-shadow: none !important;
}

/* ZUSÄTZLICHE ERZWUNGENE RUNDE FORM - Höchste Priorität */
.email-avatar .avatar-circle,
.email-avatar .avatar-circle-mobile {
    position: relative !important;
}

/* Stelle sicher, dass ALLE Avatare in E-Mails rund sind */
.email-list .email-item .email-avatar .avatar-circle,
.email-list .email-item .email-avatar .avatar-circle-mobile,
.list-group .list-group-item .email-avatar .avatar-circle,
.list-group .list-group-item .email-avatar .avatar-circle-mobile {
    border-radius: 50% !important;
    -webkit-border-radius: 50% !important;
    -moz-border-radius: 50% !important;
    clip-path: circle(50% at 50% 50%) !important;
    -webkit-clip-path: circle(50% at 50% 50%) !important;
    border-top-left-radius: 50% !important;
    border-top-right-radius: 50% !important;
    border-bottom-left-radius: 50% !important;
    border-bottom-right-radius: 50% !important;
}

/* Fallback für nicht authentifizierte Benutzer */
:not([data-bs-theme]) .avatar-circle {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

[data-bs-theme="dark"] .avatar-circle {
    /* Akzentfarbe/Gradient wird von CSS-Variable übernommen */
    background: var(--accent-style, linear-gradient(135deg, #4a5568 0%, #2d3748 100%));
    color: white;
}

/* Improved Context Menu with Submenu - JavaScript-based */
.dropdown-submenu-container {
    position: relative;
}

.dropdown-submenu-toggle {
    display: flex !important;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
}

.dropdown-submenu-toggle::after {
    display: none !important; /* Remove Bootstrap default arrow */
}

.dropdown-submenu-arrow {
    font-size: 0.75rem;
    transition: transform 0.2s ease;
    margin-left: auto;
}

.dropdown-submenu-arrow.rotated {
    transform: rotate(90deg);
}

.dropdown-submenu-menu {
    display: none;
    position: absolute;
    top: 0;
    left: 100%;
    min-width: 180px;
    padding: 0.5rem 0;
    margin: 0;
    list-style: none;
    background-color: var(--bs-dropdown-bg, #fff);
    border: 1px solid var(--bs-dropdown-border-color, rgba(0,0,0,.15));
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    z-index: 1001;
}

.dropdown-submenu-menu.show {
    display: block;
}

/* Mobile: Submenu inline anzeigen statt seitlich */
@media (max-width: 767.98px) {
    .dropdown-submenu-menu {
        position: static !important;
        left: auto !important;
        right: auto !important;
        border: none;
        box-shadow: none;
        background-color: transparent;
        padding-left: 1rem;
        margin-top: 0.25rem;
    }
    
    .dropdown-submenu-menu .dropdown-item {
        padding-left: 2rem;
        font-size: 0.9rem;
    }
    
    .dropdown-submenu-arrow {
        transform: rotate(90deg);
    }
    
    .dropdown-submenu-arrow.rotated {
        transform: rotate(-90deg);
    }
}

/* Dark Mode Context Menu */
[data-bs-theme="dark"] .dropdown-menu {
    background-color: #2d3748;
    border-color: #4a5568;
}

/* Dark Mode Submenu */
[data-bs-theme="dark"] .dropdown-submenu-menu {
    background-color: #2d3748;
    border-color: #4a5568;
}

/* OLED Mode Submenu */
[data-oled-mode="true"] .dropdown-submenu-menu {
    background-color: #000000 !important;
    border: 1px solid #1a1a1a !important;
}

@media (max-width: 767.98px) {
    [data-bs-theme="dark"] .dropdown-submenu-menu,
    [data-oled-mode="true"] .dropdown-submenu-menu {
        background-color: transparent !important;
        border: none !important;
    }
}

/* OLED Mode - Dropdown Menu (Neu-Menü) */
[data-oled-mode="true"] .dropdown-menu {
    background-color: #000000 !important;
    border: 1px solid #1a1a1a !important;
    color: #ffffff !important;
}

[data-oled-mode="true"] .dropdown-item {
    color: #ffffff !important;
    background-color: transparent !important;
}

[data-oled-mode="true"] .dropdown-item:hover,
[data-oled-mode="true"] .dropdown-item:focus {
    background-color: #0a0a0a !important;
    color: #ffffff !important;
    border: 1px solid #1a1a1a !important;
}

[data-bs-theme="dark"] .dropdown-item {
    color: #e2e8f0;
}

[data-bs-theme="dark"] .dropdown-item:hover,
[data-bs-theme="dark"] .dropdown-item:focus {
    background-color: #4a5568;
    color: #ffffff;
}

[data-bs-theme="dark"] .dropdown-item.text-danger {
    color: #f56565 !important;
}

[data-bs-theme="dark"] .dropdown-item.text-danger:hover {
    background-color: #742a2a;
    color: #ffffff !important;
}

/* Mobile Specific Styles */

/* Mobile Avatar Circles - ERZWINGE RUNDE FORM */
.email-avatar .avatar-circle-mobile,
.email-item .avatar-circle-mobile,
.list-group-item .avatar-circle-mobile,
.email-list .avatar-circle-mobile,
div.avatar-circle-mobile,
.avatar-circle.avatar-circle-mobile {
    width: 48px !important;
    height: 48px !important;
    min-width: 48px !important;
    min-height: 48px !important;
    max-width: 48px !important;
    max-height: 48px !important;
    font-size: 1rem !important;
    border-radius: 50% !important;
    -webkit-border-radius: 50% !important;
    -moz-border-radius: 50% !important;
    border-top-left-radius: 50% !important;
    border-top-right-radius: 50% !important;
    border-bottom-left-radius: 50% !important;
    border-bottom-right-radius: 50% !important;
    background: var(--accent-style, linear-gradient(135deg, #667eea 0%, #764ba2 100%)) !important;
    color: white !important;
    /* Erzwinge runde Form mit mehreren Methoden */
    aspect-ratio: 1 / 1 !important;
    overflow: hidden !important;
    /* CLIP-PATH ERZWINGT RUNDE FORM */
    clip-path: circle(50% at 50% 50%) !important;
    -webkit-clip-path: circle(50% at 50% 50%) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    /* Verhindere alle möglichen Überschreibungen */
    border-style: none !important;
    box-shadow: none !important;
}

[data-bs-theme="dark"] .avatar-circle-mobile {
    background: var(--accent-style, linear-gradient(135deg, #4a5568 0%, #2d3748 100%));
    color: white;
}

/* Mobile Touch Targets - Minimum 44x44px */
@media (max-width: 767.98px) {
    .email-content {
        width: 100%;
        max-width: 100%;
        padding: 0;
        margin: 0;
    }
    
    .email-item {
        padding: 1rem !important;
        min-height: 80px;
        width: 100%;
    }
    
    .email-item a {
        min-height: 60px;
        display: flex;
        align-items: center;
    }
    
    .btn-sm {
        min-height: 44px;
        min-width: 44px;
        padding: 0.5rem;
    }
    
    .dropdown-toggle {
        min-height: 44px;
        min-width: 44px;
    }
    
    .email-avatar {
        flex-shrink: 0;
    }
    
    /* Mobile Folder Menu Overlay */
    .offcanvas-start {
        width: 280px;
        max-width: 85vw;
    }
    
    .offcanvas-start .list-group-item {
        padding: 1rem 1.25rem;
        min-height: 56px;
        display: flex;
        align-items: center;
        font-size: 1rem;
    }
    
    .offcanvas-start .list-group-item i {
        font-size: 1.25rem;
        width: 24px;
    }
    
    /* Mobile Email List Improvements */
    .email-sender {
        font-size: 0.95rem;
        font-weight: 600;
    }
    
    .email-subject {
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .email-preview {
        font-size: 0.85rem;
        line-height: 1.4;
    }
    
    /* Mobile Email Viewer */
    .email-content-wrapper {
        margin: 0;
        border-radius: 0;
        width: 100%;
        max-width: 100%;
        overflow: visible;
    }
    
    .email-content-isolated {
        border-radius: 0;
        padding: 1rem;
        margin: 0;
        width: 100%;
        max-width: 100%;
        /* Verhindere contain: strict auf mobil, da es zu Problemen führt */
        contain: none;
        isolation: isolate;
        box-sizing: border-box;
    }
    
    .email-content-header {
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
    }
    
    .email-content-header .btn-group {
        width: 100%;
    }
    
    .email-content-header .btn {
        flex: 1;
        min-height: 44px;
    }
    
    /* Mobile Zoom Controls */
    .email-content-header .btn-group[aria-label="Zoom"] {
        flex-shrink: 0;
    }
    
    .email-content-header .btn-group[aria-label="Zoom"] .btn {
        min-width: 44px;
        padding: 0.5rem;
    }
    
    /* Zoom-Funktion für E-Mail-Inhalte */
    .email-content-wrapper {
        overflow-x: auto !important;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch;
        /* Erlaube Zoom-Overflow */
        min-height: 0;
    }
    
    .email-content-wrapper .email-html-content {
        transition: zoom 0.2s ease, transform 0.2s ease;
        /* Zoom-Container - erlaube Overflow für Zoom */
        overflow: visible !important;
        position: relative;
        /* Zoom funktioniert besser mit display: block */
        display: block !important;
    }
    
    /* Zoom-Container sollte nicht die Breite einschränken */
    .email-content-wrapper .email-html-content[style*="zoom"] {
        width: 100% !important;
        max-width: 100% !important;
    }
    
    /* Mobile Fluid Layout - Verbesserte Skalierung */
    .email-html-content,
    .email-text-content {
        font-size: 16px; /* Prevent zoom on iOS */
        line-height: 1.6;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow-x: auto;
        overflow-y: visible;
        -webkit-overflow-scrolling: touch;
        /* Verhindere contain: strict auf mobil */
        contain: none;
        /* Erlaube Skalierung */
        transform: none;
    }
    
    /* Mobile E-Mail HTML Content - Korrekte Skalierung */
    .email-content-wrapper .email-html-content {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
        overflow-x: auto !important;
        overflow-y: visible !important;
        contain: none !important;
        transform: none !important;
        padding: 1rem !important;
    }
    
    /* Alle Kindelemente skalieren */
    .email-content-wrapper .email-html-content * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    .email-content-wrapper .email-html-content img {
        max-width: 100% !important;
        width: auto !important;
        height: auto !important;
        display: block;
    }
    
    .email-content-wrapper .email-html-content table {
        display: block !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
        white-space: nowrap;
    }
    
    .email-content-wrapper .email-html-content table td,
    .email-content-wrapper .email-html-content table th {
        white-space: nowrap;
    }
    
    /* Container für E-Mail-Inhalte */
    .email-content-isolated-inner,
    .email-body-wrapper {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow-x: auto !important;
    }
    
    /* Verhindere, dass Container die Breite einschränken */
    .card {
        width: 100%;
        max-width: 100%;
        margin-left: 0;
        margin-right: 0;
    }
    
    .card-body {
        overflow-x: visible;
        width: 100%;
        max-width: 100%;
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    .card-body .email-content-wrapper {
        margin-left: 0;
        margin-right: 0;
        padding-left: 0;
        padding-right: 0;
        width: 100%;
        max-width: 100%;
    }
    
    /* Viewport Meta Tag Kompatibilität - Full Width */
    .email-viewer-body {
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    
    .email-content-wrapper {
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
    }
    
    .email-content-wrapper .email-html-content {
        /* Nutze die volle verfügbare Breite */
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 1rem !important;
        padding-right: 1rem !important;
        box-sizing: border-box !important;
    }
    
    /* Innerer Container */
    .email-content-isolated-inner {
        width: 100% !important;
        max-width: 100% !important;
    }
    
    /* Alle Elemente innerhalb der E-Mail skalieren */
    .email-content-wrapper .email-html-content div,
    .email-content-wrapper .email-html-content p,
    .email-content-wrapper .email-html-content span,
    .email-content-wrapper .email-html-content section,
    .email-content-wrapper .email-html-content article,
    .email-content-wrapper .email-html-content .email-body-wrapper,
    .email-content-wrapper .email-html-content .email-content-isolated-inner {
        max-width: 100% !important;
        width: 100% !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        box-sizing: border-box !important;
    }
    
    /* Verhindere feste Breiten aus E-Mails */
    .email-content-wrapper .email-html-content [style*="width"] {
        max-width: 100% !important;
    }
    
    /* Überschreibe feste Breiten mit !important */
    .email-content-wrapper .email-html-content [width] {
        width: auto !important;
        max-width: 100% !important;
    }
    
    /* Container skalieren */
    .email-content-wrapper .email-html-content > div,
    .email-content-wrapper .email-html-content > section,
    .email-content-wrapper .email-html-content > article {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
    }
}

/* ============================================
   KRITISCHE REGEL: ERZWINGE RUNDE AVATARE IN E-MAILS
   Diese Regel muss am Ende stehen für höchste Priorität
   ============================================ */
div.avatar-circle,
div.avatar-circle-mobile,
.email-avatar div.avatar-circle,
.email-avatar div.avatar-circle-mobile,
.email-item .email-avatar div.avatar-circle,
.email-item .email-avatar div.avatar-circle-mobile,
.list-group-item .email-avatar div.avatar-circle,
.list-group-item .email-avatar div.avatar-circle-mobile {
    /* ERZWINGE PERFEKTE RUNDE FORM */
    border-radius: 50% !important;
    -webkit-border-radius: 50% !important;
    -moz-border-radius: 50% !important;
    border-top-left-radius: 50% !important;
    border-top-right-radius: 50% !important;
    border-bottom-left-radius: 50% !important;
    border-bottom-right-radius: 50% !important;
    /* CLIP-PATH ERZWINGT RUNDE FORM - FUNKTIONIERT IMMER */
    clip-path: circle(50% at 50% 50%) !important;
    -webkit-clip-path: circle(50% at 50% 50%) !important;
    /* Verhindere alle Überschreibungen */
    border: none !important;
    border-style: none !important;
    box-shadow: none !important;
    transform: none !important;
    /* Stelle sicher, dass es ein Quadrat ist */
    aspect-ratio: 1 / 1 !important;
    overflow: hidden !important;
}

/* ============================================
   E-MAIL ZITAT-STYLING (OUTLOOK/GMAIL-STIL)
   ============================================ */

/* Zitat-Separator (horizontale Linie) */
.email-quote-separator {
    border: none;
    border-top: 1px solid var(--bs-border-color, #dee2e6);
    margin: 1.5rem 0 1rem 0;
}

/* Zitat-Header "Am [Datum] schrieb [Absender]:" */
.email-quote-header {
    color: var(--bs-secondary-color, #6c757d);
    font-size: 0.9rem;
    font-style: italic;
    margin-bottom: 0.5rem;
}

/* Zitierter Text mit linkem Rahmen */
.email-quote-block,
.email-compose-quote {
    border-left: 3px solid var(--bs-primary, #0d6efd);
    padding-left: 1rem;
    margin-left: 0;
    color: var(--bs-secondary-color, #6c757d);
}

/* Quill Editor: Zitat-Styling für "> " Zeilen */
.ql-editor p:has(> br:first-child) + p,
.ql-container .ql-editor {
    /* Basis-Styling */
}

/* Styling für Zeilen die mit "> " beginnen im Editor */
.ql-editor {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

/* Dark Mode Zitat-Styling */
[data-bs-theme="dark"] .email-quote-separator {
    border-top-color: #4a5568;
}

[data-bs-theme="dark"] .email-quote-header {
    color: #a0aec0;
}

[data-bs-theme="dark"] .email-quote-block,
[data-bs-theme="dark"] .email-compose-quote {
    border-left-color: var(--bs-primary, #4299e1);
    color: #a0aec0;
}

/* OLED Mode Zitat-Styling */
[data-oled-mode="true"] .email-quote-separator {
    border-top-color: #1a1a1a !important;
}

[data-oled-mode="true"] .email-quote-header {
    color: #888888 !important;
}

[data-oled-mode="true"] .email-quote-block,
[data-oled-mode="true"] .email-compose-quote {
    border-left-color: var(--accent-color, #4299e1) !important;
    color: #888888 !important;
}

/* Kollabierbare Zitate (optional) */
.email-quote-collapsible {
    cursor: pointer;
    user-select: none;
}

.email-quote-collapsible::before {
    content: '▼ ';
    font-size: 0.75rem;
    transition: transform 0.2s ease;
    display: inline-block;
}

.email-quote-collapsible.collapsed::before {
    transform: rotate(-90deg);
}

.email-quote-content {
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.email-quote-content.collapsed {
    max-height: 0;
}

/* Vorschau für lange Zitate */
.email-quote-preview {
    color: var(--bs-secondary-color, #6c757d);
    font-style: italic;
    margin-top: 0.25rem;
}

/* E-Mail Compose: Bessere Darstellung des Zitat-Bereichs */
.email-compose-original {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--bs-border-color, #dee2e6);
}

[data-bs-theme="dark"] .email-compose-original {
    border-top-color: #4a5568;
}

[data-oled-mode="true"] .email-compose-original {
    border-top-color: #1a1a1a !important;
}
